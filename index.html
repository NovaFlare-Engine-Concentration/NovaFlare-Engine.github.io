<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaFlare Engine | 新星闪耀引擎</title>
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body></body>
    <!-- 星星背景 -->
    <canvas id="starfield"></canvas>

    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container navbar-container">
            <div class="navbar-logo">
                <img src="images/logo.png" alt="NovaFlare Engine Logo">
                <h1 data-en="NovaFlare Engine" data-zh="新星闪耀引擎">新星闪耀引擎</h1>
            </div>
            <div class="navbar-menu">
                <div class="navbar-actions">
                    <button id="theme-toggle" aria-label="切换主题">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="lang-toggle" aria-label="切换语言">
                        <span data-en="中" data-zh="EN">中</span>
                    </button>
                </div>
                <button class="mobile-menu-btn" id="menu-toggle" aria-label="菜单">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- 主页面内容 -->
    <main>
        <!-- 英雄区域 -->
        <section class="hero section" id="hero">
            <div class="container">
                <div class="hero-content" style="position: relative;">
                    <div style="position: relative; z-index: 2;">
                        <h1 class="hero-brand" data-en="NovaFlare Engine" data-zh="NovaFlare Engine">NovaFlare Engine</h1>
                        <h1 class="hero-title" data-en="The Next Generation of FNF Engine" data-zh="下一代 FNF 引擎">下一代 FNF 引擎</h1>
                        <p class="hero-subtitle" data-en="Based on Psych Engine, optimized for performance and extensibility" 
                           data-zh="基于 Psych Engine，为性能和扩展性优化">
                            基于 Psych Engine，为性能和扩展性优化
                        </p>
                    </div>
                    <style>
                        @keyframes float {
                            0% { transform: translateY(-90%); }
                            50% { transform: translateY(-88%); }
                            100% { transform: translateY(-90%); }
                        }
                    </style>
                    <div style="position: absolute; top: 70%; right: -400px; height: 400px; width: 400px; z-index: 1; animation: float 5s ease-in-out infinite;">
                        <img src="images/logo2.png" alt="Logo" style="height: 150%; width: 150%; object-fit: contain; opacity: 0.5; mask-image: linear-gradient(to right, rgba(0,0,0,1), transparent); -webkit-mask-image: linear-gradient(to right, rgba(0,0,0,1), transparent);">
                    </div>
                    <div class="hero-buttons">
                        <a href="#download" class="btn btn-primary" data-en="Get Started" data-zh="开始使用">开始使用</a>
                        <a href="#docs" class="btn btn-secondary" data-en="Learn More" data-zh="了解更多">了解更多</a>
                        <p style="margin-top: 15px; font-size: 0.8rem; color: var(--text-secondary);">
                            <span data-en="Thank you very much for your domain name support from Ajwyunsx, the domain is valid from 2025.8.7 ~ 2026.8.7" 
                                  data-zh="万分感谢来自Ajwyunsx提供的域名赞助，域名有效期 2025.8.7 ～ 2026.8.7">
                                万分感谢来自<a href="https://github.com/Ajwyunsx" style="color: var(--accent-color);">Ajwyunsx</a>提供的域名赞助，域名有效期 2025.8.7 ～ 2026.8.7
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 项目概述 -->
        <section class="project-overview section" style="padding: 80px 0;">
            <div class="container">
                <h2 class="section-title" data-en="Overview" data-zh="项目概述">项目概述</h2>
                <h2 class="overview-content">
                    <span data-en=
                          "Engine originally used on VS Camellia fanmade.It was later moved to support modules"
                          data-zh=
                          "最初用于 VS Camellia 的自制项目。后来被移至支持Mods">最初用于 VS Camellia 的自制项目。后来被移至支持Mods</span>
                </h2>
            </div>
        </section>

        <!-- 文档区域 - 统一背景样式 -->
        <section class="docs section" id="docs" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Documentation" data-zh="文档">文档</h2>
                <div class="docs-content">
                    <div class="docs-text">
                        <h3 class="feature-title" data-en="Comprehensive Documentation（No need to rush, it's still in development.）" data-zh="全面的文档（正在开发莫要着急）">全面的文档（正在开发莫要着急）</h3>
                        <p class="feature-description" data-en="Everything you need to get started with NovaFlare Engine" 
                           data-zh="开始使用 NovaFlare Engine 所需的一切">开始使用 NovaFlare Engine 所需的一切</p>
                        <div class="hero-buttons">
                            <a href="#" class="btn btn-primary" data-en="Compilation Guide" data-zh="编译指南">入门指南</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 下载栏 - 添加版本信息 -->
        <section class="download section" id="download" style="padding: 80px 0;">
            <div class="container">
                <h2 class="section-title" data-en="Download" data-zh="下载">下载</h2>
                <div class="download-info">
                    <div id="version-info">
                        <span class="version-label" data-en="Latest Version" data-zh="最新版本">最新版本: </span>
                        <span id="latest-version" class="version-value">-</span>
                        <span id="release-date" class="version-date"></span>
                    </div>
                    <div id="download-buttons" class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span data-en="Loading download links..." data-zh="正在加载下载链接...">正在加载下载链接...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 社区区域 - 简化版 -->
        <section class="community section" id="community" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Community" data-zh="社区">社区</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 40px;">
                    <div style="background: rgba(var(--bg-card-rgb), 0.9); padding: 30px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 20px; color: var(--text-primary);">
                            <i class="fab fa-discord"></i>
                        </div>
                        <h3 style="font-size: 1.3rem; margin-bottom: 10px;" data-en="Join Discord" data-zh="加入 Discord">加入 Discord</h3>
                        <p style="margin-bottom: 20px; color: var(--text-secondary);" data-en="Communicate with other developers." data-zh="与其他开发者交流">与其他开发者交流</p>
                        <a href="https://discord.gg/FkEwvRW2YZ" class="btn btn-primary" style="display: inline-block;" data-en="Join" data-zh="加入">加入</a>
                    </div>
                    <div style="background: rgba(var(--bg-card-rgb), 0.9); padding: 30px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 20px; color: var(--text-primary);">
                            <i class="fab fa-github"></i>
                        </div>
                        <h3 style="font-size: 1.3rem; margin-bottom: 10px;">GitHub</h3>
                        <p style="margin-bottom: 20px; color: var(--text-secondary);" data-en="Contribute to the project" data-zh="为项目做贡献">为项目做贡献</p>
                        <a href="https://github.com/NovaFlare-Engine-Concentration/FNF-NovaFlare-Engine" class="btn btn-secondary" style="display: inline-block;" data-en="View" data-zh="查看">查看</a>
                    </div>
                    <div style="background: rgba(var(--bg-card-rgb), 0.9); padding: 30px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 20px; color: var(--text-primary);">
                            <i class="fab fa-youtube"></i>
                        </div>
                        <h3 style="font-size: 1.3rem; margin-bottom: 10px;">YouTube</h3>
                        <p style="margin-bottom: 20px; color: var(--text-secondary);" data-en="Watch tutorials and demos" data-zh="观看教程和演示">观看教程和演示</p>
                        <a href="https://youtube.com/@beihu235" class="btn btn-primary" style="display: inline-block;" data-en="Subscribe" data-zh="订阅">订阅</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 历史版本区域 - 带收起功能和Markdown支持 -->
        <section class="version-history section" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Version History" data-zh="历史版本">历史版本</h2>
                <div id="versions-content">
                    <div id="latest-version-card" class="version-card"></div>
                    <button id="toggle-versions" class="toggle-btn" style="margin: 20px 0;">
                        <i class="fas fa-chevron-down"></i>
                        <span class="toggle-text" data-en="Collapse" data-zh="收起">收起</span>
                    </button>
                    <div id="other-versions">
                        <div id="versions-container">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span data-en="Loading versions..." data-zh="正在加载版本...">正在加载版本...</span>
                            </div>
                        </div>
                        <div class="pagination" id="versions-pagination" style="margin-top: 30px; display: none;">
                            <button class="btn btn-secondary" id="prev-page" disabled><i class="fas fa-chevron-left"></i></button>
                            <span id="page-info" style="margin: 0 15px;">1/1</span>
                            <button class="btn btn-secondary" id="next-page" disabled><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <script>
        // 从GitHub获取版本数据
        document.addEventListener('DOMContentLoaded', function() {
            const repoOwner = 'NovaFlare-Engine-Concentration';
            const repoName = 'FNF-NovaFlare-Engine';
            const perPage = 1; // 每页只显示1个版本
            
            let currentPage = 1;
            let totalPages = 1;
            let allReleases = [];
            let isCollapsed = false;
            
            // 初始化收起状态
            function initCollapseState() {
                const otherVersions = document.getElementById('other-versions');
                const toggleBtn = document.getElementById('toggle-versions');
                const icon = toggleBtn.querySelector('i');
                
                // 默认收起
                otherVersions.style.display = 'none';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
                updateToggleText();
            }
            
            // 更新收起按钮文本（根据当前语言）
            function updateToggleText() {
                const toggleBtn = document.getElementById('toggle-versions');
                if (!toggleBtn) return;
                
                const text = toggleBtn.querySelector('.toggle-text');
                const isChinese = document.documentElement.lang === 'zh';
                
                if (isCollapsed) {
                    text.textContent = isChinese ? '展开' : 'Expand';
                } else {
                    text.textContent = isChinese ? '收起' : 'Collapse';
                }
            }
            
            // 监听语言切换
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'lang') {
                        updateToggleText();
                    }
                });
            });
            
            observer.observe(document.documentElement, {
                attributes: true
            });
            
            // 收起/展开切换
            document.getElementById('toggle-versions').addEventListener('click', function() {
                const otherVersions = document.getElementById('other-versions');
                const icon = this.querySelector('i');
                
                isCollapsed = !isCollapsed;
                
                if (isCollapsed) {
                    otherVersions.style.display = 'none';
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                } else {
                    otherVersions.style.display = 'grid'; // 使用网格布局
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                    // 展开时滚动到版本历史部分
                    setTimeout(() => {
                        document.querySelector('.version-history.section').scrollIntoView({behavior: 'smooth'});
                    }, 100); // 添加小延迟确保展开动画完成
                }
                updateToggleText();
            });

            // 增强版Markdown转HTML（支持加粗和明文链接）
            function markdownToHtml(text) {
                if (!text) return '<p>No release notes provided</p>';
                
                // 处理加粗语法
                text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                           .replace(/\_\_(.*?)\_\_/g, '<strong>$1</strong>');
                
                // 保留换行
                text = text.replace(/\n/g, '<br>');
                // 处理Markdown格式链接
                text = text.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
                // 处理明文链接（http/https/ftp）
                text = text.replace(/(https?:\/\/|ftp:\/\/)([^\s<]+)/g, '<a href="$1$2" target="_blank">$1$2</a>');
                // 代码块
                text = text.replace(/```([^`]+)```/g, '<pre><code>$1</code></pre>');
                // 内联代码
                text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
                
                return `<div class="markdown-content">${text}</div>`;
            }
            
            // 获取GitHub Releases
            async function fetchReleases() {
                try {
                    const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/releases`);
                    if (!response.ok) throw new Error('Failed to fetch releases');
                    
                    allReleases = await response.json();
                    totalPages = Math.ceil((allReleases.length - 1) / perPage); // 减去最新版本
                    
                    updateDownloadSection();
                    renderLatestVersion();
                    renderReleases();
                    updatePagination();
                } catch (error) {
                    document.getElementById('versions-container').innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span data-en="Failed to load versions" data-zh="加载版本失败">加载版本失败</span>
                        </div>
                    `;
                    document.getElementById('download-buttons').innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span data-en="Failed to load download links" data-zh="加载下载链接失败">加载下载链接失败</span>
                        </div>
                    `;
                    console.error('Error fetching releases:', error);
                }
            }
            
            // 更新下载栏版本信息
            function updateDownloadSection() {
                if (allReleases.length === 0) return;
                
                const latestRelease = allReleases[0];
                document.getElementById('latest-version').textContent = latestRelease.tag_name;
                document.getElementById('release-date').textContent = `(${new Date(latestRelease.published_at).toLocaleDateString()})`;
                
                // 更新下载按钮
                const buttonsHTML = latestRelease.assets.map(asset => `
                    <a href="${asset.browser_download_url}" class="btn btn-primary download-btn">
                        <i class="fas fa-download"></i> ${asset.name}
                    </a>
                `).join('');
                
                document.getElementById('download-buttons').innerHTML = buttonsHTML;
            }
            
            // 渲染最新版本卡片（默认展开）
            function renderLatestVersion() {
                if (allReleases.length === 0) return;
                
                const latestRelease = allReleases[0];
                document.getElementById('latest-version-card').innerHTML = `
                    <div class="version-header">
                        <h3>${latestRelease.tag_name}</h3>
                        <span class="version-date">${new Date(latestRelease.published_at).toLocaleDateString()}</span>
                    </div>
                    <div class="version-body">
                        <div class="markdown-preview">${markdownToHtml(latestRelease.body)}</div>
                        <div class="version-assets">
                            ${latestRelease.assets.map(asset => `
                                <a href="${asset.browser_download_url}" class="btn btn-primary">
                                    <i class="fas fa-download"></i> ${asset.name}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                // 默认展开卡片内容
                const preview = document.querySelector('#latest-version-card .markdown-preview');
                if (preview && preview.scrollHeight > 80) {
                    preview.style.maxHeight = '80px';
                    preview.style.overflow = 'hidden';
                }
            }
            
            // 渲染其他版本
            function renderReleases() {
                const scrollPosition = window.scrollY || window.pageYOffset;
                
                if (allReleases.length <= 1) {
                    document.getElementById('versions-container').innerHTML = `
                        <p class="no-versions" data-en="No other versions available" data-zh="没有其他版本">没有其他版本</p>
                    `;
                    return;
                }
                
                // 跳过最新版本(索引0)
                const startIdx = (currentPage - 1) * perPage + 1;
                const endIdx = Math.min(startIdx + perPage, allReleases.length);
                const currentReleases = allReleases.slice(startIdx, endIdx);
                
                const versionsHTML = currentReleases.map(release => `
                    <div class="version-card">
                        <div class="version-header">
                            <h3>${release.tag_name}</h3>
                            <span class="version-date">${new Date(release.published_at).toLocaleDateString()}</span>
                        </div>
                        <div class="version-body">
                            ${markdownToHtml(release.body)}
                            <div class="version-assets">
                                ${release.assets.map(asset => `
                                    <a href="${asset.browser_download_url}" class="btn btn-secondary">
                                        <i class="fas fa-download"></i> ${asset.name}
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('versions-container').innerHTML = `
                    <div class="versions-grid">
                        ${versionsHTML}
                    </div>
                `;
                
                document.getElementById('versions-pagination').style.display = totalPages > 1 ? 'flex' : 'none';
            }
            
            // 更新分页控件
            function updatePagination() {
                document.getElementById('page-info').textContent = `${currentPage}/${totalPages}`;
                document.getElementById('prev-page').disabled = currentPage <= 1;
                document.getElementById('next-page').disabled = currentPage >= totalPages;
            }
            
            // 分页按钮事件
            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderReleases();
                    updatePagination();
                    // 滚动到版本历史部分
                    setTimeout(() => {
                        document.querySelector('.version-history.section').scrollIntoView({behavior: 'smooth'});
                    }, 100); // 添加小延迟确保展开动画完成
                }
            });
            
            document.getElementById('next-page').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderReleases();
                    updatePagination();
                    // 滚动到版本历史部分
                    document.querySelector('.version-history.section').scrollIntoView({behavior: 'smooth'});
                }
            });
            
            // 初始化
            fetchReleases();
        });
        </script>

        <!-- 贡献者区域 - 简化版 -->
        <section class="contributors section" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Contributors" data-zh="贡献者">贡献者</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-top: 20px;">
                    <div class="main-dev-card">
                        <a href="https://github.com/beihu235" target="_blank" rel="noopener noreferrer" class="dev-link">
                            <img src="https://avatars.githubusercontent.com/u/105789304?v=4" alt="Contributor" class="main-dev-avatar">
                            <h4 class="dev-name">beihu235</h4>
                        </a>
                        <p class="dev-title" data-en="Main Programmer" data-zh="核心开发者">核心开发者</p>
                        <p class="dev-description" data-en="----------------" data-zh="----------------">----------------</p>
                        <a href="contributors.html" class="dev-description" data-en="View All Contributors" data-zh="查看全部贡献者">查看全部贡献者</a>
                        </div>
                        <div id="fading-contributors" class="fading-contributors-container"></div>
                </div>
            </div>
        </section>

        <section class="contributors section" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Special Thanks" data-zh="特别鸣谢">特别鸣谢</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-top: 20px;">
                    <div class="main-dev-card">
                        <a href="https://github.com/Ajwyunsx" target="_blank" rel="noopener noreferrer" class="dev-link">
                            <img src="https://avatars.githubusercontent.com/u/105789304?v=4" alt="Contributor" class="main-dev-avatar">
                            <h4 class="dev-name">beihu235</h4>
                        </a>
                        <p class="dev-title" data-en="Domain name provider" data-zh="域名提供者">域名提供者</p>
                        <p class="dev-description" data-en="----------------" data-zh="----------------">----------------</p
                        </div>
                        <div id="fading-contributors" class="fading-contributors-container"></div>
                </div>
            </div>
        </section>

        <!--<section class="special-thanks section" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Special Thanks" data-zh="特别鸣谢">特别鸣谢</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-top: 20px;">
                    <div class="main-dev-card">
                        <a href="https://github.com/Ajwyunsx" target="_blank" rel="noopener noreferrer" class="dev-link">
                            <img src="https://avatars.githubusercontent.com/u/105789304?v=4" alt="Contributor" class="main-dev-avatar">
                            <h4 class="dev-name">Ajwyunsx</h4>
                        </a>
                        <p class="dev-title" data-en="Domain name provider" data-zh="域名提供者">域名提供者</p>
                        <p class="dev-description" data-en="----------------" data-zh="----------------">----------------</p>
                    </div>
                </div>
            </div>
        </section>
        -->
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <script src="js/contributors.js"></script>
        <div class="container">
            <div class="footer-content">
                <p>NovaFlare Engine</p>
            </div>
            <ul class="footer-links">
                <li><a href="#features" data-en="Features" data-zh="特性">特性</a></li>
                <li><a href="#download" data-en="Download" data-zh="下载">下载</a></li>
                <li><a href="#docs" data-en="Documentation" data-zh="文档">文档</a></li>
                <li><a href="#community" data-en="Community" data-zh="社区">社区</a></li>
            </ul>
            <div class="footer-social">
                <a href="https://discord.gg/FkEwvRW2YZ" target="_blank" aria-label="Discord"><i class="fab fa-discord"></i></a>
                <a href="https://github.com/NovaFlare-Engine-Concentration/FNF-NovaFlare-Engine/" target="_blank" aria-label="GitHub"><i class="fab fa-github"></i></a>
                <a href="https://youtube.com/@beihu235" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
            </div>
            
            <div class="footer-copyright">
                <a href="https://github.com/NovaFlare-Engine-Concentration/NovaFlare-Engine.github.io" class="dev-description" data-en="The Github repository of this page" data-zh=此页面的Github仓库>此页面的Github仓库</a>
                <!-- <p>&copy; 1145 NovaFlare Engine. <span data-en="All rights reserved." data-zh="保留所有权利。">保留所有权利。</span></p> -->
            </div>
        </div>
    </footer>

        </div>
    </footer>

    
    <script src="js/starfield.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/language.js"></script>
    <script src="js/main.js"></script>
    <script src="js/fading-contributors.js"></script>
</body>
</html>
