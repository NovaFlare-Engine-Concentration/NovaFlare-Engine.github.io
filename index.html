<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaFlare Engine | 新星闪耀引擎</title>
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body></body>
    <!-- 星星背景 -->
    <canvas id="starfield"></canvas>

    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container navbar-container">
            <div class="navbar-logo">
                <img src="images/logo.png" alt="NovaFlare Engine Logo">
                <h1 data-en="NovaFlare Engine" data-zh="新星闪耀引擎">新星闪耀引擎</h1>
            </div>
            <div class="navbar-menu">
                <ul class="nav-links">
                    <!-- 导航链接已移除 -->
                </ul>
                <div class="navbar-actions">
                    <button id="theme-toggle" aria-label="切换主题">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="lang-toggle" aria-label="切换语言">
                        <span data-en="中" data-zh="EN">中</span>
                    </button>
                </div>
                <button class="mobile-menu-btn" id="menu-toggle" aria-label="菜单">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- 主页面内容 -->
    <main>
        <!-- 英雄区域 -->
        <section class="hero section" id="hero">
            <div class="container">
                <div class="hero-content">
                    <h1 class="hero-title" data-en="The Next Generation of FNF Engine" data-zh="下一代 FNF 引擎">下一代 FNF 引擎</h1>
                    <p class="hero-subtitle" data-en="Based on Psych Engine, optimized for performance and extensibility" 
                       data-zh="基于 Psych Engine，为性能和扩展性优化">
                        基于 Psych Engine，为性能和扩展性优化
                    </p>
                    <div class="hero-buttons"></div>
                        <a href="#download" class="btn btn-primary" data-en="Get Started" data-zh="开始使用">开始使用</a>
                        <a href="#docs" class="btn btn-secondary" data-en="Learn More" data-zh="了解更多">了解更多</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 特性区域 - 统一背景样式 -->
        <section class="features section" id="features" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Features" data-zh="特性">特性</h2>
                <div class="features-grid">
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3 class="feature-title" data-en="High Performance" data-zh="高性能">高性能</h3>
                        <p class="feature-description" data-en="Optimized rendering and memory management" 
                           data-zh="优化的渲染和内存管理">优化的渲染和内存管理</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-puzzle-piece"></i>
                        </div>
                        <h3 class="feature-title" data-en="Modular Design" data-zh="模块化设计">模块化设计</h3>
                        <p class="feature-description" data-en="Easy to extend and customize" 
                           data-zh="易于扩展和定制">易于扩展和定制</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-code"></i>
                        </div>
                        <h3 class="feature-title" data-en="Developer Friendly" data-zh="开发者友好">开发者友好</h3>
                        <p class="feature-description" data-en="Comprehensive API and documentation" 
                           data-zh="完整的API和文档">完整的API和文档</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 下载区域 - 统一背景样式 -->
        <section class="download section" id="download" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Download" data-zh="下载">下载</h2>
                <div style="display: flex; justify-content: center; gap: 30px; margin-top: 40px;">
                    <div style="background: var(--bg-card); padding: 30px; border-radius: 12px; width: 300px;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 15px;">最新版本</h3>
                        <p style="margin-bottom: 10px; font-size: 1.1rem;">版本: v1.1.0</p>
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">发布日期: 2023-11-15</p>
                        <a href="https://github.com/NovaFlare-Engine-Concentration/FNF-NovaFlare-Engine/releases/latest" 
                           class="btn btn-primary" 
                           style="display: block; width: 100%; text-align: center;">
                           下载
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 文档区域 - 统一背景样式 -->
        <section class="docs section" id="docs" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Documentation" data-zh="文档">文档</h2>
                <div class="docs-content">
                    <div class="docs-text">
                        <h3 class="feature-title" data-en="Comprehensive Documentation" data-zh="全面的文档">全面的文档</h3>
                        <p class="feature-description" data-en="Everything you need to get started with NovaFlare Engine" 
                           data-zh="开始使用 NovaFlare Engine 所需的一切">开始使用 NovaFlare Engine 所需的一切</p>
                        <div class="hero-buttons">
                            <a href="#" class="btn btn-primary" data-en="Getting Started" data-zh="入门指南">入门指南</a>
                            <a href="#" class="btn btn-secondary" data-en="API Reference" data-zh="API 参考">API 参考</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 社区区域 - 简化版 -->
        <section class="community section" id="community" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Community" data-zh="社区">社区</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 40px;">
                    <div style="background: rgba(var(--bg-card-rgb), 0.9); padding: 30px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 20px; color: var(--text-primary);">
                            <i class="fab fa-discord"></i>
                        </div>
                        <h3 style="font-size: 1.3rem; margin-bottom: 10px;">加入 Discord</h3>
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">与其他开发者交流</p>
                        <a href="#" class="btn btn-primary" style="display: inline-block;">加入</a>
                    </div>
                    <div style="background: rgba(var(--bg-card-rgb), 0.9); padding: 30px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 20px; color: var(--text-primary);">
                            <i class="fab fa-github"></i>
                        </div>
                        <h3 style="font-size: 1.3rem; margin-bottom: 10px;">GitHub</h3>
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">为项目做贡献</p>
                        <a href="#" class="btn btn-secondary" style="display: inline-block;">查看</a>
                    </div>
                    <div style="background: rgba(var(--bg-card-rgb), 0.9); padding: 30px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 20px; color: var(--text-primary);">
                            <i class="fab fa-youtube"></i>
                        </div>
                        <h3 style="font-size: 1.3rem; margin-bottom: 10px;">YouTube</h3>
                        <p style="margin-bottom: 20px; color: var(--text-secondary);">观看教程和演示</p>
                        <a href="https://youtube.com/beihu235" class="btn btn-primary" style="display: inline-block;">订阅</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 下载栏 - 添加版本信息 -->
        <section class="download section" style="padding: 80px 0;">
            <div class="container">
                <h2 class="section-title" data-en="Download" data-zh="下载">下载</h2>
                <div class="download-info">
                    <div id="version-info">
                        <span class="version-label" data-en="Latest Version" data-zh="最新版本">最新版本: </span>
                        <span id="latest-version" class="version-value">-</span>
                        <span id="release-date" class="version-date"></span>
                    </div>
                    <div id="download-buttons" class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span data-en="Loading download links..." data-zh="正在加载下载链接...">正在加载下载链接...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 历史版本区域 - 带收起功能和Markdown支持 -->
        <section class="version-history section" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title" data-en="Version History" data-zh="历史版本">历史版本</h2>
                    <button id="toggle-versions" class="toggle-btn">
                        <i class="fas fa-chevron-down"></i>
                        <span class="toggle-text" data-en="Collapse" data-zh="收起">收起</span>
                    </button>
                </div>
                <div id="versions-content">
                    <div id="latest-version-card" class="version-card"></div>
                    <div id="other-versions">
                        <div id="versions-container">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span data-en="Loading versions..." data-zh="正在加载版本...">正在加载版本...</span>
                            </div>
                        </div>
                        <div class="pagination" id="versions-pagination" style="margin-top: 30px; display: none;">
                            <button class="btn btn-secondary" id="prev-page" disabled><i class="fas fa-chevron-left"></i></button>
                            <span id="page-info" style="margin: 0 15px;">1/1</span>
                            <button class="btn btn-secondary" id="next-page" disabled><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <script>
        // 从GitHub获取版本数据
        document.addEventListener('DOMContentLoaded', function() {
            const repoOwner = 'NovaFlare-Engine-Concentration';
            const repoName = 'FNF-NovaFlare-Engine';
            const perPage = 5; // 每页显示5个版本
            
            let currentPage = 1;
            let totalPages = 1;
            let allReleases = [];
            let isCollapsed = false;
            
            // 收起/展开切换
            document.getElementById('toggle-versions').addEventListener('click', function() {
                const otherVersions = document.getElementById('other-versions');
                const icon = this.querySelector('i');
                const text = this.querySelector('.toggle-text');
                
                isCollapsed = !isCollapsed;
                
                if (isCollapsed) {
                    otherVersions.style.display = 'none';
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                    text.textContent = text.dataset.zh === '展开' ? '展开' : 'Expand';
                } else {
                    otherVersions.style.display = 'block';
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                    text.textContent = text.dataset.zh === '收起' ? '收起' : 'Collapse';
                }
            });

            // 简单Markdown转HTML（保留换行和基本格式）
            function markdownToHtml(text) {
                if (!text) return '<p>No release notes provided</p>';
                
                // 保留换行
                text = text.replace(/\n/g, '<br>');
                // 简单链接检测
                text = text.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
                // 代码块
                text = text.replace(/```([^`]+)```/g, '<pre><code>$1</code></pre>');
                // 内联代码
                text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
                
                return `<div class="markdown-content">${text}</div>`;
            }
            
            // 获取GitHub Releases
            async function fetchReleases() {
                try {
                    const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/releases`);
                    if (!response.ok) throw new Error('Failed to fetch releases');
                    
                    allReleases = await response.json();
                    totalPages = Math.ceil((allReleases.length - 1) / perPage); // 减去最新版本
                    
                    updateDownloadSection();
                    renderLatestVersion();
                    renderReleases();
                    updatePagination();
                } catch (error) {
                    document.getElementById('versions-container').innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span data-en="Failed to load versions" data-zh="加载版本失败">加载版本失败</span>
                        </div>
                    `;
                    document.getElementById('download-buttons').innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span data-en="Failed to load download links" data-zh="加载下载链接失败">加载下载链接失败</span>
                        </div>
                    `;
                    console.error('Error fetching releases:', error);
                }
            }
            
            // 更新下载栏版本信息
            function updateDownloadSection() {
                if (allReleases.length === 0) return;
                
                const latestRelease = allReleases[0];
                document.getElementById('latest-version').textContent = latestRelease.tag_name;
                document.getElementById('release-date').textContent = `(${new Date(latestRelease.published_at).toLocaleDateString()})`;
                
                // 更新下载按钮
                const buttonsHTML = latestRelease.assets.map(asset => `
                    <a href="${asset.browser_download_url}" class="btn btn-primary download-btn">
                        <i class="fas fa-download"></i> ${asset.name}
                    </a>
                `).join('');
                
                document.getElementById('download-buttons').innerHTML = buttonsHTML;
            }
            
            // 渲染最新版本卡片
            function renderLatestVersion() {
                if (allReleases.length === 0) return;
                
                const latestRelease = allReleases[0];
                document.getElementById('latest-version-card').innerHTML = `
                    <div class="version-header">
                        <h3>${latestRelease.tag_name}</h3>
                        <span class="version-date">${new Date(latestRelease.published_at).toLocaleDateString()}</span>
                    </div>
                    <div class="version-body">
                        ${markdownToHtml(latestRelease.body)}
                        <div class="version-assets">
                            ${latestRelease.assets.map(asset => `
                                <a href="${asset.browser_download_url}" class="btn btn-primary">
                                    <i class="fas fa-download"></i> ${asset.name}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // 渲染其他版本
            function renderReleases() {
                if (allReleases.length <= 1) {
                    document.getElementById('versions-container').innerHTML = `
                        <p class="no-versions" data-en="No other versions available" data-zh="没有其他版本">没有其他版本</p>
                    `;
                    return;
                }
                
                // 跳过最新版本(索引0)
                const startIdx = (currentPage - 1) * perPage + 1;
                const endIdx = Math.min(startIdx + perPage, allReleases.length);
                const currentReleases = allReleases.slice(startIdx, endIdx);
                
                const versionsHTML = currentReleases.map(release => `
                    <div class="version-card">
                        <div class="version-header">
                            <h3>${release.tag_name}</h3>
                            <span class="version-date">${new Date(release.published_at).toLocaleDateString()}</span>
                        </div>
                        <div class="version-body">
                            ${markdownToHtml(release.body)}
                            <div class="version-assets">
                                ${release.assets.map(asset => `
                                    <a href="${asset.browser_download_url}" class="btn btn-secondary">
                                        <i class="fas fa-download"></i> ${asset.name}
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('versions-container').innerHTML = `
                    <div class="versions-grid">
                        ${versionsHTML}
                    </div>
                `;
                
                document.getElementById('versions-pagination').style.display = totalPages > 1 ? 'flex' : 'none';
            }
            
            // 更新分页控件
            function updatePagination() {
                document.getElementById('page-info').textContent = `${currentPage}/${totalPages}`;
                document.getElementById('prev-page').disabled = currentPage <= 1;
                document.getElementById('next-page').disabled = currentPage >= totalPages;
            }
            
            // 分页按钮事件
            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderReleases();
                    updatePagination();
                }
            });
            
            document.getElementById('next-page').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderReleases();
                    updatePagination();
                }
            });
            
            // 初始化
            fetchReleases();
        });
        </script>

        <!-- 贡献者区域 - 简化版 -->
        <section class="contributors section" style="padding: 80px 0; background: rgba(var(--bg-secondary-rgb), 0.8); border-top: 1px solid var(--border-color);">
            <div class="container">
                <h2 class="section-title" data-en="Contributors" data-zh="贡献者">贡献者</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-top: 40px;">
                    <div style="background: rgba(var(--bg-card-rgb), 0.9); padding: 20px; border-radius: 8px; text-align: center;">
                        <img src="images/contributors/user1.png" alt="Contributor" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 0 auto 15px;">
                        <h4 style="margin-bottom: 5px;">开发者1</h4>
                        <p style="color: var(--text-secondary);">核心开发者</p>
                    </div>
                    <div style="background: rgba(var(--bg-card-rgb), 0.9); padding: 20px; border-radius: 8px; text-align: center;">
                        <img src="images/contributors/user2.png" alt="Contributor" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 0 auto 15px;">
                        <h4 style="margin-bottom: 5px;">开发者2</h4>
                        <p style="color: var(--text-secondary);">UI设计师</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>NovaFlare Engine</p>
            </div>
            <ul class="footer-links">
                <li><a href="#features" data-en="Features" data-zh="特性">特性</a></li>
                <li><a href="#download" data-en="Download" data-zh="下载">下载</a></li>
                <li><a href="#docs" data-en="Documentation" data-zh="文档">文档</a></li>
                <li><a href="#community" data-en="Community" data-zh="社区">社区</a></li>
            </ul>
            <div class="footer-social">
                <a href="https://discord.gg/novflare" target="_blank" aria-label="Discord"><i class="fab fa-discord"></i></a>
                <a href="https://github.com/NovaFlare-Engine-Concentration/FNF-NovaFlare-Engine/" target="_blank" aria-label="GitHub"><i class="fab fa-github"></i></a>
                <a href="https://youtube.com/beihu235" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
            </div>
            <!--
            <div class="footer-copyright">
                <p>&copy; 1145 NovaFlare Engine. <span data-en="All rights reserved." data-zh="保留所有权利。">保留所有权利。</span></p>
            </div>
            -->
        </div>
    </footer>

        </div>
    </footer>

    
    <script src="js/starfield.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/language.js"></script>
    <script src="js/main.js"></script>
</body>
</html>